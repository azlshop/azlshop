<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…ØªØ¬Ø± Ø£Ø²Ù„ | azl MG shop</title>

  <style>
    :root{
      --bg:#f7f8fb;
      --card:#ffffff;
      --line:#e5e7eb;
      --muted:#6b7280;
      --dark:#111827;
      --shadow: 0 10px 28px rgba(17,24,39,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#111}
    header{
      position:sticky;top:0;z-index:20;
      background:rgba(255,255,255,.9);backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1120px;margin:0 auto;padding:14px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{
      display:flex;align-items:center;gap:10px;font-weight:900;
    }
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:linear-gradient(135deg,#111827,#334155);
      box-shadow: var(--shadow);
    }
    .muted{color:var(--muted);font-size:13px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    .btn{
      border:1px solid var(--dark);background:var(--dark);color:#fff;
      border-radius:999px;padding:10px 14px;cursor:pointer;
      font-weight:650;
    }
    .ghost{background:#fff;color:#111;border:1px solid var(--line)}
    .btn:active{transform:translateY(1px)}
    .pill{
      border:1px solid var(--line);background:#fff;color:#111;
      border-radius:999px;padding:8px 12px;cursor:pointer;
      font-weight:650;
    }
    .pill.active{background:#111827;color:#fff;border-color:#111827}

    .hero{
      margin-top:14px;background:var(--card);border:1px solid var(--line);
      border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);
      display:flex;gap:14px;justify-content:space-between;align-items:center;flex-wrap:wrap;
    }
    .badges{display:flex;gap:10px;flex-wrap:wrap}
    .badge{
      display:flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;
      font-size:12px;color:#111;
    }
    .dot{width:8px;height:8px;border-radius:99px;background:#22c55e}

    .grid{
      margin-top:14px;
      display:grid;grid-template-columns:repeat(2,1fr);gap:12px;
    }
    @media(min-width:900px){.grid{grid-template-columns:repeat(4,1fr)}}

    .card{
      background:var(--card);border:1px solid var(--line);
      border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);
      display:flex;flex-direction:column;
    }
    .img{height:150px;background:linear-gradient(180deg,#f3f4f6,#fff)}
    .p{padding:12px;display:grid;gap:10px}
    .price{font-weight:800}
    select,input[type="file"]{
      width:100%;
      padding:10px;border-radius:14px;border:1px solid var(--line);background:#fff;
    }
    .small{font-size:12px;color:var(--muted)}

    /* Drawer */
    .drawer{position:fixed;inset:0;pointer-events:none;z-index:9999}
    .drawer.open{pointer-events:auto}
    .back{position:absolute;inset:0;background:rgba(0,0,0,.35);opacity:0;transition:.2s}
    .drawer.open .back{opacity:1}
    .panel{
      position:absolute;inset-inline-end:0;top:0;bottom:0;
      width:min(440px,94vw);background:#fff;border-inline-start:1px solid var(--line);
      transform:translateX(110%);transition:.2s;
      display:flex;flex-direction:column;
    }
    html[dir="ltr"] .panel{transform:translateX(-110%)}
    .drawer.open .panel{transform:translateX(0)}
    .head{padding:14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .body{padding:14px;overflow:auto;flex:1}
    .foot{padding:14px;border-top:1px solid var(--line)}
    .cartItem{
      border:1px solid var(--line);border-radius:16px;padding:12px;margin-bottom:10px;
      background:#fff;
    }
    .between{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .danger{color:#b91c1c}
    .ok{color:#166534}
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div id="brandTxt">Ù…ØªØ¬Ø± Ø£Ø²Ù„</div>
          <div class="muted" id="hintTxt">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
        </div>
      </div>

      <div class="row">
        <button class="btn ghost" id="langBtn">EN</button>
        <button class="btn ghost" id="cartBtn">ğŸ›’ <span id="count">0</span></button>
      </div>
    </div>

    <div class="hero">
      <div>
        <div style="font-weight:900;font-size:16px" id="heroTitle">ØªØ¬Ø±Ø¨Ø© Ø´Ø±Ø§Ø¡ Ø³Ø±ÙŠØ¹Ø© ÙˆÙ†Ø¸ÙŠÙØ©</div>
        <div class="muted" id="heroSub">Ø§Ø®ØªØ± Ù‚Ø³Ù…Ù‹Ø§ØŒ Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©ØŒ Ø«Ù… Ø§Ø¯ÙØ¹ Ø¹Ø¨Ø± Stripe Ø£Ùˆ Ø§Ø·Ù„Ø¨ COD Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.</div>
      </div>
      <div class="badges">
        <div class="badge"><span class="dot"></span><span id="b1">Ø¯ÙØ¹ Ø¢Ù…Ù†</span></div>
        <div class="badge"><span class="dot"></span><span id="b2">COD Ù…ØªØ§Ø­</span></div>
        <div class="badge"><span class="dot"></span><span id="b3">Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ</span></div>
      </div>
    </div>

    <div class="row" id="cats" style="margin-top:12px"></div>
  </div>
</header>

<main class="wrap">
  <section class="grid" id="grid"></section>
</main>

<!-- Drawer -->
<aside class="drawer" id="drawer" aria-hidden="true">
  <div class="panel">
    <div class="head">
      <b id="cartTitle">Ø³Ù„ØªÙƒ</b>
      <button class="btn ghost" id="closeBtn">âœ•</button>
    </div>

    <div class="body">
      <div id="items"></div>
    </div>

    <div class="foot">
      <div class="between">
        <span id="totalLabel">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
        <b id="total">AED 0.00</b>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn" id="payBtn">Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†</button>
        <button class="btn ghost" id="codBtn">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (COD)</button>
      </div>

      <div class="muted" id="note" style="margin-top:10px">
        COD: Ø³Ù†Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¯ÙˆÙ† Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†.
      </div>

      <div class="muted danger" id="err" style="display:none;margin-top:10px"></div>
    </div>
  </div>
  <div class="back" id="back"></div>
</aside>

<script>
  // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ
  const WORKER_URL = "https://azlshop.eng-suwan.workers.dev";
  const COD_WHATSAPP = "971544219984";

  // âœ… ØªØ±Ø¬Ù…Ø©
  const dict = {
    ar: {
      brand:"Ù…ØªØ¬Ø± Ø£Ø²Ù„", hint:"Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
      heroTitle:"ØªØ¬Ø±Ø¨Ø© Ø´Ø±Ø§Ø¡ Ø³Ø±ÙŠØ¹Ø© ÙˆÙ†Ø¸ÙŠÙØ©",
      heroSub:"Ø§Ø®ØªØ± Ù‚Ø³Ù…Ù‹Ø§ØŒ Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©ØŒ Ø«Ù… Ø§Ø¯ÙØ¹ Ø¹Ø¨Ø± Stripe Ø£Ùˆ Ø§Ø·Ù„Ø¨ COD Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.",
      b1:"Ø¯ÙØ¹ Ø¢Ù…Ù†", b2:"COD Ù…ØªØ§Ø­", b3:"Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ",
      cart:"Ø³Ù„ØªÙƒ", total:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
      pay:"Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†", cod:"Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (COD)",
      add:"Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©",
      all:"Ø§Ù„ÙƒÙ„",
      empty:"Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.",
      size:"Ø§Ù„Ø­Ø¬Ù…",
      pieces:"Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹",
      upload:"Ø§Ø±ÙØ¹ ØµÙˆØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©",
      files:"Ø§Ù„ØµÙˆØ±",
      needFiles:"Ù„Ø§Ø²Ù… ØªØ±ÙØ¹ ØµÙˆØ± Ø¨Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹",
      note:"COD: Ø³Ù†Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¯ÙˆÙ† Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†.",
      remove:"Ø­Ø°Ù",
      refresh:"Ø¥Ø°Ø§ Ù…Ø§ Ø¸Ù‡Ø±Øª Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ø¹Ù…Ù„ Refresh Ù…Ø¹ Ctrl+F5."
    },
    en: {
      brand:"azl MG shop", hint:"Latest products",
      heroTitle:"Clean & fast shopping experience",
      heroSub:"Pick a category, add to cart, then pay via Stripe or order COD on WhatsApp.",
      b1:"Secure payments", b2:"COD available", b3:"Auto Arabic/English",
      cart:"Your cart", total:"Total",
      pay:"Pay now", cod:"Cash on Delivery (COD)",
      add:"Add to cart",
      all:"All",
      empty:"Your cart is empty.",
      size:"Size",
      pieces:"Pieces",
      upload:"Upload print files",
      files:"Files",
      needFiles:"You must upload files equal to pieces",
      note:"COD: we will place the order without payment.",
      remove:"Remove",
      refresh:"If updates do not show, hard refresh with Ctrl+F5."
    }
  };

  const $ = (s)=>document.querySelector(s);
  function detectLang(){
    const l = (navigator.language || "en").toLowerCase();
    return l.startsWith("ar") ? "ar" : "en";
  }

  const state = {
    lang: localStorage.getItem("azl_lang") || detectLang(),
    cart: JSON.parse(localStorage.getItem("azl_cart") || "[]"),
    categories: [],
    products: [],
    activeCategory: "all"
  };

  function t(k){ return dict[state.lang][k]; }
  function money(x){ return `AED ${Number(x).toFixed(2)}`; }
  function save(){
    localStorage.setItem("azl_lang", state.lang);
    localStorage.setItem("azl_cart", JSON.stringify(state.cart));
  }
  function showErr(msg){
    const el = $("#err");
    el.style.display = msg ? "block" : "none";
    el.textContent = msg || "";
  }

  // âœ… Fix NaN: migrate old cart values from previous versions
  (function migrateCart(){
    const cart = Array.isArray(state.cart) ? state.cart : [];
    state.cart = cart.map((it)=>{
      const qty = Number(it.qty ?? 1);
      const priceRaw = it.price ?? it.unitPrice ?? it.unit_amount ?? 0;
      const price = Number(priceRaw);
      return {
        ...it,
        qty: (Number.isFinite(qty) && qty>0) ? qty : 1,
        price: Number.isFinite(price) ? price : 0,
        pieces: it.pieces ? Number(it.pieces) : it.pieces,
        size: it.size || it.sizeKey || it.sizeLabel || null,
        filesCount: Number(it.filesCount ?? 0)
      };
    }).filter(it => it && (it.id || it.key));
    save();
  })();

  // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† products.json.txt (Ù„Ø£Ù† Ù…Ù„ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØºØ©)
  async function loadProducts(){
    const res = await fetch("/products.json.txt", { cache:"no-store" });
    if(!res.ok) throw new Error("products.json.txt not found (HTTP "+res.status+")");

    const text = await res.text();
    let data;
    try { data = JSON.parse(text); }
    catch(e){ throw new Error("products.json.txt is not valid JSON. " + (e?.message||e)); }

    state.categories = Array.isArray(data.categories) ? data.categories : [];
    state.products = Array.isArray(data.products) ? data.products : [];
  }

  function applyLang(){
    document.documentElement.lang = state.lang;
    document.documentElement.dir  = state.lang==="ar" ? "rtl" : "ltr";

    $("#brandTxt").textContent = t("brand");
    $("#hintTxt").textContent  = t("hint");
    $("#heroTitle").textContent = t("heroTitle");
    $("#heroSub").textContent = t("heroSub");
    $("#b1").textContent = t("b1");
    $("#b2").textContent = t("b2");
    $("#b3").textContent = t("b3");
    $("#cartTitle").textContent = t("cart");
    $("#totalLabel").textContent = t("total");
    $("#payBtn").textContent = t("pay");
    $("#codBtn").textContent = t("cod");
    $("#note").textContent = t("note");
    $("#langBtn").textContent = state.lang==="ar" ? "EN" : "AR";
  }

  function renderCategories(){
    const cats = [
      {id:"all", ar:t("all"), en:t("all")},
      ...state.categories
    ];
    $("#cats").innerHTML = cats.map(c=>`
      <button class="pill ${state.activeCategory===c.id?'active':''}" data-cat="${c.id}">
        ${state.lang==="ar" ? (c.ar||c.en||c.id) : (c.en||c.ar||c.id)}
      </button>
    `).join("");

    $("#cats").querySelectorAll("[data-cat]").forEach(b=>{
      b.addEventListener("click", ()=>{
        state.activeCategory = b.dataset.cat;
        renderCategories();
        renderProducts();
      });
    });
  }

  function getList(){
    return (state.activeCategory==="all")
      ? state.products
      : state.products.filter(p => p.category === state.activeCategory);
  }

  function renderProducts(){
    const list = getList();
    $("#grid").innerHTML = list.map(p=>{
      const name = p.name?.[state.lang] || p.name?.en || p.name?.ar || "-";
      const isMagnetic = p.type === "magnetic_print";

      if(isMagnetic){
        // Sizes and pieces are required selections
        const sizes = Array.isArray(p.sizes) ? p.sizes : [];
        const pieces = Array.isArray(p.pieces) ? p.pieces : [];

        return `
          <article class="card">
            <div class="img"></div>
            <div class="p">
              <b>${name}</b>
              <div class="small">${t("size")}</div>
              <select id="size_${p.id}">
                ${sizes.map(s=>`
                  <option value="${s.key}" data-price="${s.price}">
                    ${state.lang==="ar" ? s.ar : s.en} â€” ${money(s.price)}
                  </option>
                `).join("")}
              </select>

              <div class="small">${t("pieces")}</div>
              <select id="pieces_${p.id}">
                ${pieces.map(n=>`<option value="${n}">${n}</option>`).join("")}
              </select>

              <div class="small">${t("upload")} (${t("needFiles")})</div>
              <input type="file" id="files_${p.id}" multiple accept="image/*,.jpg,.jpeg,.png,.pdf" />

              <button class="btn" data-add="${p.id}">${t("add")}</button>
              <div class="muted small">${t("refresh")}</div>
            </div>
          </article>
        `;
      } else {
        const price = Number(p.price || 0);
        return `
          <article class="card">
            <div class="img"></div>
            <div class="p">
              <b>${name}</b>
              <div class="price">${money(price)}</div>
              <button class="btn" data-add="${p.id}">${t("add")}</button>
            </div>
          </article>
        `;
      }
    }).join("");

    document.querySelectorAll("[data-add]").forEach(btn=>{
      btn.addEventListener("click", ()=> addToCart(btn.dataset.add));
    });

    updateCartUI();
  }

  function addToCart(id){
    showErr("");

    const p = state.products.find(x=>x.id===id);
    if(!p) return;

    // magnetic product requires size + pieces + files count
    if(p.type === "magnetic_print"){
      const sizeEl = document.getElementById(`size_${id}`);
      const piecesEl = document.getElementById(`pieces_${id}`);
      const filesEl = document.getElementById(`files_${id}`);

      const sizeKey = sizeEl?.value;
      const pieces = Number(piecesEl?.value || 0);
      const filesCount = filesEl?.files ? filesEl.files.length : 0;

      if(!sizeKey || !pieces){
        showErr(state.lang==="ar" ? "Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ù… ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹" : "Select size and pieces");
        return;
      }
      if(filesCount !== pieces){
        showErr(t("needFiles") + ` (${t("files")}: ${filesCount}/${pieces})`);
        return;
      }

      const sizeObj = (p.sizes||[]).find(s=>s.key===sizeKey);
      const price = Number(sizeObj?.price || 0);
      const sizeLabel = state.lang==="ar" ? (sizeObj?.ar||sizeKey) : (sizeObj?.en||sizeKey);

      const key = `${id}|${sizeKey}|${pieces}`;
      const it = state.cart.find(x=>x.key===key);
      if(it){
        it.qty += 1;
        it.filesCount = filesCount; // keep info
      } else {
        state.cart.push({
          key, id,
          name: p.name,
          qty: 1,
          price,
          type: p.type,
          sizeKey,
          sizeLabel,
          pieces,
          filesCount
        });
      }
    } else {
      const price = Number(p.price || 0);
      const key = `${id}|-|-`;
      const it = state.cart.find(x=>x.key===key);
      if(it) it.qty += 1;
      else state.cart.push({ key, id, name:p.name, qty:1, price, type:p.type || "simple" });
    }

    save();
    updateCartUI();
    openCart();
  }

  function removeItem(key){
    state.cart = state.cart.filter(i => i.key !== key);
    save();
    updateCartUI();
  }

  function updateCartUI(){
    const count = state.cart.reduce((s,i)=>s + Number(i.qty||0), 0);
    $("#count").textContent = count;

    const total = state.cart.reduce((s,i)=> s + (Number(i.price||0) * Number(i.qty||0)), 0);
    $("#total").textContent = money(total);

    const box = $("#items");
    if(!state.cart.length){
      box.innerHTML = `<div class="muted">${t("empty")}</div>`;
      return;
    }

    box.innerHTML = state.cart.map(i=>{
      const name = i.name?.[state.lang] || i.name?.en || i.name?.ar || "-";
      const extra = (i.type==="magnetic_print")
        ? `<div class="small muted">â€¢ ${t("size")}: ${i.sizeLabel} â€¢ ${t("pieces")}: ${i.pieces} â€¢ ${t("files")}: ${i.filesCount}/${i.pieces}</div>`
        : "";

      return `
        <div class="cartItem">
          <div class="between">
            <b>${name}</b>
            <button class="btn ghost" style="padding:6px 10px" data-rm="${i.key}">${t("remove")}</button>
          </div>
          ${extra}
          <div class="between" style="margin-top:8px">
            <span class="muted">${money(i.price)} Ã— ${i.qty}</span>
            <b>${money(Number(i.price)*Number(i.qty))}</b>
          </div>
        </div>
      `;
    }).join("");

    document.querySelectorAll("[data-rm]").forEach(b=>{
      b.addEventListener("click", ()=> removeItem(b.dataset.rm));
    });
  }

  function openCart(){ $("#drawer").classList.add("open"); }
  function closeCart(){ $("#drawer").classList.remove("open"); }

  async function payNow(){
    try{
      showErr("");
      if(!state.cart.length){ openCart(); return; }

      // validate magnetic items files count
      for(const i of state.cart){
        if(i.type==="magnetic_print"){
          if(Number(i.filesCount||0) !== Number(i.pieces||0)){
            throw new Error(t("needFiles") + ` (${t("files")}: ${i.filesCount}/${i.pieces})`);
          }
        }
      }

      const items = state.cart.map(i=>{
        const name = (i.name?.[state.lang] || i.name?.en || i.name?.ar || "Item");
        const opt = i.type==="magnetic_print"
          ? ` â€” ${t("size")}: ${i.sizeLabel} â€” ${t("pieces")}: ${i.pieces}`
          : "";
        return {
          name: String(name + opt),
          unit_amount: Number(i.price),
          quantity: Number(i.qty)
        };
      });

      const res = await fetch(`${WORKER_URL}/create-checkout-session`,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ currency:"AED", lang: state.lang, items })
      });

      const text = await res.text();
      let data = null;
      try { data = JSON.parse(text); } catch { data = { raw:text }; }

      if(!res.ok) throw new Error(data.error || data.raw || ("Worker error " + res.status));
      if(!data.url) throw new Error("No checkout URL returned");

      location.href = data.url;
    } catch(e){
      showErr("Payment error: " + (e?.message || e));
      alert("Payment error: " + (e?.message || e));
      openCart();
    }
  }

  function placeCOD(){
    const total = state.cart.reduce((s,i)=> s + (Number(i.price||0)*Number(i.qty||0)), 0);
    const lines = state.cart.map(i=>{
      const name = (i.name?.[state.lang] || i.name?.en || i.name?.ar || "-");
      const opt = i.type==="magnetic_print" ? ` (${i.sizeLabel}, ${t("pieces")}: ${i.pieces})` : "";
      return `- ${name}${opt} x${i.qty} = ${money(Number(i.price)*Number(i.qty))}`;
    }).join("\n");

    const msg = (state.lang==="ar")
      ? `Ø·Ù„Ø¨ COD Ù…Ù† Ù…ØªØ¬Ø± Ø£Ø²Ù„\n${lines}\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${money(total)}`
      : `COD order from azl MG shop\n${lines}\nTotal: ${money(total)}`;

    window.open(`https://wa.me/${COD_WHATSAPP}?text=${encodeURIComponent(msg)}`,"_blank","noopener");
  }

  // events
  $("#langBtn").addEventListener("click", ()=>{
    state.lang = (state.lang==="ar") ? "en" : "ar";
    save();
    applyLang();
    renderCategories();
    renderProducts();
  });
  $("#cartBtn").addEventListener("click", openCart);
  $("#back").addEventListener("click", closeCart);
  $("#closeBtn").addEventListener("click", closeCart);
  $("#payBtn").addEventListener("click", payNow);
  $("#codBtn").addEventListener("click", placeCOD);

  // boot
  (async ()=>{
    try{
      await loadProducts();
      applyLang();
      renderCategories();
      renderProducts();
      updateCartUI();
    } catch(e){
      applyLang();
      showErr("Load error: " + (e?.message || e));
      $("#grid").innerHTML = `<div class="muted">Load error: ${(e?.message||e)}</div>`;
    }
  })();
</script>
</body>
</html>
